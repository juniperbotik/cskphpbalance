<!DOCTYPE html>
<html>
<head>
    <title>Рабочие прокси</title>
</head>
<body>
    <pre id="proxyList"></pre>

    <script>
        async function loadProxyList() {
            const proxyUrls = [
                "https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/socks4.txt",
                "https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/socks5.txt",
                "https://raw.githubusercontent.com/roosterkid/openproxylist/main/SOCKS4_RAW.txt",
                "https://raw.githubusercontent.com/roosterkid/openproxylist/main/SOCKS5_RAW.txt"
            ];

            let workingProxies = [];

            try {
                for (let i = 0; i < proxyUrls.length; i++) {
                    const response = await fetch(proxyUrls[i]);
                    const text = await response.text();
                    const proxies = text.trim().split("\n");
                    workingProxies = workingProxies.concat(await checkProxies(proxies));
                }

                const proxyListElement = document.getElementById("proxyList");
                proxyListElement.textContent = workingProxies.join("\n");
            } catch (error) {
                console.error("Error loading or checking proxies:", error);
            }
        }

        function checkProxies(proxies) {
            const timeout = 5000;
            const workingProxies = [];

            return new Promise((resolve) => {
                const checkNextProxy = async (index) => {
                    if (index < proxies.length) {
                        try {
                            const proxy = proxies[index];
                            const parts = proxy.split(":");
                            const ip = parts[0];
                            const port = parseInt(parts[1]);

                            const response = await fetch("https://example.com", {
                                method: "GET",
                                mode: "no-cors",
                                cache: "no-cache",
                                redirect: "follow",
                                referrerPolicy: "no-referrer",
                                agent: new window.socks5HttpAgent({ socksHost: ip, socksPort: port }),
                                timeout: timeout
                            });

                            if (response.ok) {
                                workingProxies.push(proxy);
                            }
                        } catch (error) {
                            console.log(`Error checking proxy: ${proxies[index]}`);
                        }

                        setTimeout(() => {
                            checkNextProxy(index + 1);
                        }, 0); // Мгновенно переходить к следующей проверке

                    } else {
                        resolve(workingProxies);
                    }
                };

                checkNextProxy(0);
            });
        }

        loadProxyList();
    </script>
</body>
</html>
